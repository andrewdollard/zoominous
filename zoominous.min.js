/* Zoominous - v0.0.1 - 2013-07-03
 * Full-screen mobile image viewer
 * https://github.com/andrewdollard/zoominous
 * Andrew Dollard <andrewdollard@gmail.com>  */
!function(a){"use strict";a.fn.zoominous=function(b){var c={namespace:"zoominous"},d=a.extend(c,b);return this.each(function(){function b(){r=z.width(),s=z.height(),q=a(window).height(),p=a(window).width(),v=r/s,w=p/q,v>w?(r=p,z.width(r),z.height("auto"),s=z.height(),t=0,u=(q-z.height())/2):(s=q,z.height(s),z.width("auto"),r=z.width(),u=0,t=(p-z.width())/2),n=1,e(t,u)}function c(a,b,c){var d=r,f=s;v>w?(r=p*a,z.width(r),s=z.height()):(s=q*a,z.height(s),z.width("auto"),r=z.width());var g=d/(b-t),h=f/(c-u),i=t-(r-d)/g,j=u-(s-f)/h;e(i,j)}function e(a,b){z.css({y:b,x:a}),t=a,u=b}function f(a,b){z.stop().transition({y:b,x:a},300),t=a,u=b}function g(){var a=u+s,b=t+r;p>r?t=(p-r)/2:(0>t&&p>b&&(t=p-r),b>p&&t>0&&(t=0)),q>s?u=(q-s)/2:(0>u&&q>a&&(u=q-s),a>q&&u>0&&(u=0)),f(t,u)}function h(){A.show().removeClass("hidden"),clearInterval(o),o=setTimeout(function(){i()},6e3)}function i(){A.addClass("hidden")}function j(){a(window).resize(function(){B&&b()}),x.click(function(){B||(B=!0,z.attr("src")||z.attr("src",z.data("src")),y.imagesLoaded(function(){y.css("background-image","none"),b(!1)}),y.fadeIn(400,function(){z.show(),h()}))}),new Hammer(y[0]).on("touch",function(a){a.gesture.preventDefault()}).on("doubletap",function(a){a.gesture.preventDefault(),a.gesture.stopDetect(),b(),h()}).on("tap",function(a){a.gesture.preventDefault(),A.hasClass("hidden")?h():i()}),new Hammer(A[0]).on("touch",function(){A.hasClass("hidden")||(a(window).off("resize.zoominous"),A.hide(),y.fadeOut(function(){B=!1}))}),new Hammer(z[0],{transform_always_block:!0}).on("dragstart",function(a){a.gesture.preventDefault(),k=t,l=u}).on("drag",function(a){a.gesture&&!C&&(a.gesture.preventDefault(),r>p&&(t=k+a.gesture.deltaX),s>q&&(u=l+a.gesture.deltaY),e(t,u))}).on("dragend",function(a){a.gesture&&!C&&(a.gesture.preventDefault(),g())}).on("transformstart",function(){m=n,C=!0}).on("transform",function(b){b.gesture.preventDefault(),n=b.gesture.scale*m,n>5?n=5:1>n&&(n=1),c(n,b.gesture.center.pageX,b.gesture.center.pageY-a(window).scrollTop())}).on("transformend",function(a){a.gesture.preventDefault(),C=!1,g()}).on("touch",function(a){a.gesture.preventDefault()})}var k,l,m,n,o,p,q,r,s,t,u,v,w,x=a(this),y=x.find("."+d.namespace+"-fullscreen"),z=y.find("img").first(),A=y.find("."+d.namespace+"-close-wrapper"),B=!1,C=!1;j()})}}(jQuery);