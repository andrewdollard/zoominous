/* Zoominous mobile image viewer - v0.0.1
   Andrew Dollard (andrewdollard@gmail.com)
   Built on: 2013-07-03 */
!function(a){"use strict";a.fn.zoominous=function(){return this.each(function(){function b(){q=y.width(),r=y.height(),p=a(window).height(),o=a(window).width(),u=q/r,v=o/p,u>v?(q=o,y.width(q),y.height("auto"),r=y.height(),s=0,t=(p-y.height())/2):(r=p,y.height(r),y.width("auto"),q=y.width(),t=0,s=(o-y.width())/2),m=1,d(s,t)}function c(a,b,c){var e=q,f=r;u>v?(q=o*a,y.width(q),r=y.height()):(r=p*a,y.height(r),y.width("auto"),q=y.width());var g=e/(b-s),h=f/(c-t),i=s-(q-e)/g,j=t-(r-f)/h;d(i,j)}function d(a,b){y.css({y:b,x:a}),s=a,t=b}function e(a,b){y.stop().transition({y:b,x:a},300),s=a,t=b}function f(){var a=t+r,b=s+q;o>q?s=(o-q)/2:(0>s&&o>b&&(s=o-q),b>o&&s>0&&(s=0)),p>r?t=(p-r)/2:(0>t&&p>a&&(t=p-r),a>p&&t>0&&(t=0)),e(s,t)}function g(){z.show().removeClass("hidden"),clearInterval(n),n=setTimeout(function(){h()},6e3)}function h(){z.addClass("hidden")}function i(){a(window).resize(function(){A&&b()}),w.click(function(){A||(A=!0,y.attr("src")||y.attr("src",y.data("src")),x.imagesLoaded(function(){x.css("background-image","none"),b(!1)}),x.fadeIn(400,function(){y.show(),g()}))}),new Hammer(x[0]).on("touch",function(a){a.gesture.preventDefault()}).on("doubletap",function(a){a.gesture.preventDefault(),a.gesture.stopDetect(),b(),g()}).on("tap",function(a){a.gesture.preventDefault(),z.hasClass("hidden")?g():h()}),new Hammer(z[0]).on("touch",function(){z.hasClass("hidden")||(a(window).off("resize.zoominous"),z.hide(),x.fadeOut(function(){A=!1}))}),new Hammer(y[0],{transform_always_block:!0}).on("dragstart",function(a){a.gesture.preventDefault(),j=s,k=t}).on("drag",function(a){a.gesture&&!B&&(a.gesture.preventDefault(),q>o&&(s=j+a.gesture.deltaX),r>p&&(t=k+a.gesture.deltaY),d(s,t))}).on("dragend",function(a){a.gesture&&!B&&(a.gesture.preventDefault(),f())}).on("transformstart",function(){l=m,B=!0}).on("transform",function(b){b.gesture.preventDefault(),m=b.gesture.scale*l,m>5?m=5:1>m&&(m=1),c(m,b.gesture.center.pageX,b.gesture.center.pageY-a(window).scrollTop())}).on("transformend",function(a){a.gesture.preventDefault(),B=!1,f()}).on("touch",function(a){a.gesture.preventDefault()})}var j,k,l,m,n,o,p,q,r,s,t,u,v,w=a(this),x=w.find(".zoominous-mask"),y=x.find("img").first(),z=x.find(".zoominous-close-wrapper"),A=!1,B=!1;i()})}}(jQuery);